{"data":{"markdownRemark":{"frontmatter":{"title":"Google Tag Manager and Gatsby","subtitle":"Part 1","date":"March 19, 2019","description":"Part 1 in a series of blog posts on how to integrate Google Tag Manager with GatsbyJS","keywords":["Google Tag Manager","Gatsby","GatsbyJS","React","GTM","Google Analytics","GA"]},"html":"<p>Google Tag Manager (GTM) is a tool for managing 3rd party scripts and for making data-informed decisions about your website. </p>\n<p>I will walk through some important terms and show you how to add GTM to your website.</p>\n<h2>Important terms to get started</h2>\n<p><a href=\"https://support.google.com/tagmanager#topic=3441530\">Source: Google Tag Manager Help</a></p>\n<h3>Google Tag Manager (GTM)</h3>\n<blockquote>\n<p>Google Tag Manager is a tag management system (TMS) that allows you to quickly and easily update tracking codes and related code fragments collectively known as tags on your website or mobile app. Once the small segment of Tag Manager code has been added to your project, you can safely and easily deploy analytics and measurement tag configurations from a web-based user interface.</p>\n</blockquote>\n<h3>Google Analytics (GA)</h3>\n<blockquote>\n<p>Google Analytics is a web analytics service offered by Google that tracks and reports website traffic, currently as a platform inside the Google Marketing Platform brand.</p>\n</blockquote>\n<h3>Data layer</h3>\n<blockquote>\n<p>A data layer is a JavaScript object that is used to pass information from your website to your Tag Manager container. For example:  </p>\n<div class='midnight'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>{</span></span><span>&nbsp;category</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--js\"><span>:</span></span><span>&nbsp;</span><span class=\"syntax--string syntax--quoted syntax--double syntax--js\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--js\"><span>&quot;</span></span><span>myCategory</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--js\"><span>&quot;</span></span></span><span>&nbsp;</span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>}</span></span></span></div></pre></div>\n</blockquote>\n<h3>Tags</h3>\n<blockquote>\n<p>Tags are segments of code provided by analytics, marketing, and support vendors to help you integrate their products into your websites or mobile apps. With Google Tag Manager, you no longer need to add these tags directly to your projects. Instead, you configure and publish tags and how they fire from within the Tag Manager user interface.</p>\n</blockquote>\n<h3>Triggers</h3>\n<blockquote>\n<p>Tags fire in response to events. In Google Tag Manager, a trigger listens to your web page or mobile app for certain types of events like form submissions, button clicks, or page views. The trigger tells the tag to fire when the specified event is detected. Every tag must have at least one trigger in order to fire.</p>\n</blockquote>\n<h3>Variables</h3>\n<blockquote>\n<p>Variables in Google Tag Manager are named placeholders for values that are populated when code is run on your website or mobile app. For example, the Tag Manager variable named \"Page URL\" returns the current web page URL.</p>\n</blockquote>\n<h2>Setting up GTM with Gatsby</h2>\n<p>This is a general overview of the process with Gatsby. Check <a href=\"https://developers.google.com/tag-manager/quickstart\">Google's documentation</a> for more information as it will be the most current.</p>\n<h3>Create GTM account</h3>\n<p>First, you need to create a GTM account using a Google account. Go to <a href=\"https://tagmanager.google.com\">tagmanager.google.com</a> and complete registration.</p>\n<blockquote>\n<p>NOTE: A GTM \"Container\" manages workspaces and retains container versions. I recommend naming this after your website (e.g. www.alexhughes.dev).</p>\n</blockquote>\n<h3>Add GTM to Gatsby</h3>\n<p>To add GTM to any site, you must add GTM scripts to your HTML. In Gatsby, you can do this by copying Gatby's default <code>html.js</code> file to your <code>src</code> directory and making changes.</p>\n<p><a href=\"https://www.gatsbyjs.org/docs/custom-html/\">Gatsby's documentation on editing <code>html.js</code></a></p>\n<p>Run this command in your terminal from the root directory of your Gatsby project in order to copy <code>html.js</code>:</p>\n<div class='midnight'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--text syntax--plain syntax--null-grammar\"><span>cp&nbsp;.cache/default-html.js&nbsp;src/html.js</span></span></div></pre></div>\n<p>Add then GTM script to the top of <code>html±&#x3C;head></code> in <code>src/html.js</code>. See <a href=\"https://developers.google.com/tag-manager/quickstart\">Google's Quick Start Guide</a> for where to find the GTM script. Since we are using React, you will need to add the script using <code>dangerouslySetHTML</code> as shown below. Don't worry about it being dangerous, we know what we are doing, right? <a href=\"https://reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml\">See the React documentation for <code>javascript±dangerouslySetHTML</code></a></p>\n<div class='midnight'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>{</span></span><span class=\"syntax--comment syntax--block syntax--js\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>/*</span></span><span>&nbsp;Google&nbsp;Tag&nbsp;Manager&nbsp;</span><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>*/</span></span></span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--keyword syntax--operator syntax--comparison syntax--js\"><span>&lt;</span></span><span>script&nbsp;dangerouslySetInnerHTML</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--js\"><span>=</span></span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>{</span><span>{</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__html</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--js\"><span>:</span></span><span>&nbsp;</span><span class=\"syntax--string syntax--quoted syntax--template syntax--js\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--js\"><span>`</span></span><span>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({&#39;gtm.start&#39;:&nbsp;new&nbsp;Date().getTime(),event:&#39;gtm.js&#39;});var</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--string syntax--quoted syntax--template syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f=d.getElementsByTagName(s)[0],&nbsp;j=d.createElement(s),dl=l!=&#39;dataLayer&#39;?&#39;&amp;l=&#39;+l:&#39;&#39;;j.async=true;j.src=</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--string syntax--quoted syntax--template syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;</span><span class=\"syntax--markup syntax--underline syntax--link syntax--https syntax--hyperlink\"><span>https://www.googletagmanager.com/gtm.js?id=</span></span><span>&#39;+i+dl;f.parentNode.insertBefore(j,f);</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--string syntax--quoted syntax--template syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})(window,document,&#39;script&#39;,&#39;dataLayer&#39;,&#39;GTM-&lt;GTM&nbsp;ID&nbsp;HERE&gt;&#39;);&lt;/script&gt;</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--js\"><span>`</span></span></span><span class=\"syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js\"><span>,</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>}</span><span>}</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--keyword syntax--operator syntax--js\"><span>/</span></span><span class=\"syntax--keyword syntax--operator syntax--comparison syntax--js\"><span>&gt;</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>{</span></span><span class=\"syntax--comment syntax--block syntax--js\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>/*</span></span><span>&nbsp;End&nbsp;Google&nbsp;Tag&nbsp;Manager&nbsp;</span><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>*/</span></span></span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>}</span></span></span></div></pre></div>\n<p>Also, add the <code>html±&#x3C;noscript></code> tag to the top of <code>html±&#x3C;body></code> in <code>src/html.js</code>.</p>\n<div class='midnight'><pre class=\"editor editor-colors\"><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>{</span></span><span class=\"syntax--comment syntax--block syntax--js\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>/*</span></span><span>&nbsp;&lt;!--&nbsp;Google&nbsp;Tag&nbsp;Manager&nbsp;(noscript)&nbsp;--&gt;&nbsp;</span><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>*/</span></span></span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--keyword syntax--operator syntax--comparison syntax--js\"><span>&lt;</span></span><span>noscript&nbsp;dangerouslySetInnerHTML</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--js\"><span>=</span></span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>{</span><span>{</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__html</span><span class=\"syntax--keyword syntax--operator syntax--assignment syntax--js\"><span>:</span></span><span>&nbsp;</span><span class=\"syntax--string syntax--quoted syntax--template syntax--js\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--js\"><span>`</span></span><span>&lt;iframe&nbsp;src=&quot;</span><span class=\"syntax--markup syntax--underline syntax--link syntax--https syntax--hyperlink\"><span>https://www.googletagmanager.com/ns.html?id=GTM</span></span><span>-&lt;GTM&nbsp;ID&nbsp;HERE&gt;&quot;&nbsp;height=&quot;0&quot;&nbsp;width=&quot;0&quot;</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--string syntax--quoted syntax--template syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style=&quot;display:none;visibility:hidden&quot;&gt;&lt;/iframe&gt;</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--string syntax--quoted syntax--template syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--js\"><span>`</span></span></span><span class=\"syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js\"><span>,</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>}</span><span>}</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--keyword syntax--operator syntax--js\"><span>/</span></span><span class=\"syntax--keyword syntax--operator syntax--comparison syntax--js\"><span>&gt;</span></span></span></div><div class=\"line\"><span class=\"syntax--source syntax--js\"><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>{</span></span><span class=\"syntax--comment syntax--block syntax--js\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>/*</span></span><span>&nbsp;&lt;!--&nbsp;End&nbsp;Google&nbsp;Tag&nbsp;Manager&nbsp;(noscript)&nbsp;--&gt;&nbsp;</span><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--js\"><span>*/</span></span></span><span class=\"syntax--meta syntax--brace syntax--curly syntax--js\"><span>}</span></span></span></div></pre></div>\n<p>Congrats! You've successfully connected GTM to your Gatsby site. Go ahead and reload your site and check the <code>html±&#x3C;head></code> and <code>html±&#x3C;body></code> to confirm that the scripts were successfully loaded.</p>\n<p>Continue to <a href=\"/blog/google-tag-manager-2\">Google Tag Manager and Gatsby (Part 2)</a> to see examples of how to use GTM with your site.</p>\n<h2>Resources</h2>\n<p><a href=\"https://support.google.com/tagmanager#topic=3441530\">Google Tag Manager Help</a></p>\n<p><a href=\"https://support.google.com/tagmanager/answer/6103696?hl=en\">Setup and install Tag Manager</a></p>\n<p><a href=\"https://www.analyticsmania.com/post/google-tag-manager-glossary/\">The Ultimate Google Tag Manager Glossary (160+ terms)</a></p>","fields":{"slug":"blog/google-tag-manager/"}},"site":{"siteMetadata":{"author":"Alex Fenwood Hughes"}}},"pageContext":{"slug":"blog/google-tag-manager/"}}